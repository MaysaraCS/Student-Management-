<!-- 
  MANAGE LECTURERS COMPONENT TEMPLATE
  
  ANGULAR CONCEPTS USED:
  - Structural Directives (*ngIf, *ngFor)
  - Event Binding ((click), (submit))
  - Property Binding ([disabled], [class])
  - Two-way Binding with Reactive Forms
-->

<div class="manage-container">
  <!-- Header with back button -->
  <div class="page-header">
    <button class="btn-back" (click)="goBack()">‚Üê Back to Dashboard</button>
    <h1>Manage Lecturers</h1>
  </div>

  <!-- Success/Error Messages -->
  <!-- 
    ANGULAR CONCEPT: *ngIf Directive
    Conditionally shows elements based on boolean expression
  -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
    <button class="alert-close" (click)="successMessage = ''">&times;</button>
  </div>

  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
    <button class="alert-close" (click)="errorMessage = ''">&times;</button>
  </div>

  <!-- Action Buttons -->
  <div class="action-bar">
    <button class="btn btn-primary" (click)="openCreateForm()">
      <span class="btn-icon">+</span> Create New Lecturer
    </button>
    
    <div class="stats">
      <!-- 
        ANGULAR CONCEPT: Interpolation {{ }}
        Displays dynamic data from component
      -->
      <span class="stat-badge">Total Lecturers: {{ lecturers.length }}</span>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- ==================== CREATE LECTURER FORM ==================== -->
  
  <!-- 
    ANGULAR CONCEPT: Reactive Forms
    Form is controlled by TypeScript code (createForm FormGroup)
  -->
  <div *ngIf="showCreateForm" class="form-modal">
    <div class="form-container">
      <div class="form-header">
        <h2>Create New Lecturer</h2>
        <button class="btn-close" (click)="cancelCreate()">&times;</button>
      </div>

      <form [formGroup]="createForm" (submit)="createLecturer()">
        <div class="form-grid">
          <!-- Full Name -->
          <div class="form-group">
            <label for="create-name">Full Name *</label>
            <input 
              id="create-name"
              type="text" 
              formControlName="name" 
              placeholder="Enter full name"
              class="form-input"
            />
            <!-- 
              ANGULAR CONCEPT: Form Validation
              Shows error only if field is touched and invalid
            -->
            <div class="error-text" *ngIf="createForm.get('name')?.touched && createForm.get('name')?.errors?.['required']">
              Name is required
            </div>
            <div class="error-text" *ngIf="createForm.get('name')?.touched && createForm.get('name')?.errors?.['minlength']">
              Name must be at least 3 characters
            </div>
          </div>

          <!-- Username -->
          <div class="form-group">
            <label for="create-username">Username *</label>
            <input 
              id="create-username"
              type="text" 
              formControlName="username" 
              placeholder="Enter username"
              class="form-input"
            />
            <div class="error-text" *ngIf="createForm.get('username')?.touched && createForm.get('username')?.invalid">
              Username is required (min 3 characters)
            </div>
          </div>

          <!-- Password -->
          <div class="form-group">
            <label for="create-password">Password *</label>
            <input 
              id="create-password"
              type="password" 
              formControlName="password" 
              placeholder="Enter password"
              class="form-input"
            />
            <div class="error-text" *ngIf="createForm.get('password')?.touched && createForm.get('password')?.invalid">
              Password is required (min 4 characters)
            </div>
          </div>

          <!-- Lecturer ID -->
          <div class="form-group">
            <label for="create-lecturerId">Lecturer ID *</label>
            <input 
              id="create-lecturerId"
              type="text" 
              formControlName="lecturerId" 
              placeholder="e.g., LEC001"
              class="form-input"
            />
            <div class="error-text" *ngIf="createForm.get('lecturerId')?.touched && createForm.get('lecturerId')?.invalid">
              Lecturer ID is required
            </div>
          </div>

          <!-- Department -->
          <div class="form-group">
            <label for="create-department">Department *</label>
            <input 
              id="create-department"
              type="text" 
              formControlName="department" 
              placeholder="e.g., Computer Science"
              class="form-input"
            />
            <div class="error-text" *ngIf="createForm.get('department')?.touched && createForm.get('department')?.invalid">
              Department is required
            </div>
          </div>

          <!-- Email -->
          <div class="form-group">
            <label for="create-email">Email *</label>
            <input 
              id="create-email"
              type="email" 
              formControlName="email" 
              placeholder="Enter email address"
              class="form-input"
            />
            <div class="error-text" *ngIf="createForm.get('email')?.touched && createForm.get('email')?.errors?.['required']">
              Email is required
            </div>
            <div class="error-text" *ngIf="createForm.get('email')?.touched && createForm.get('email')?.errors?.['email']">
              Please enter a valid email
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="cancelCreate()">
            Cancel
          </button>
          <!-- 
            ANGULAR CONCEPT: Property Binding [disabled]
            Disables button when form is invalid
          -->
          <button type="submit" class="btn btn-primary" [disabled]="createForm.invalid || isLoading">
            {{ isLoading ? 'Creating...' : 'Create Lecturer' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ==================== EDIT LECTURER FORM ==================== -->
  
  <div *ngIf="showEditForm" class="form-modal">
    <div class="form-container">
      <div class="form-header">
        <h2>Edit Lecturer: {{ selectedLecturer?.name }}</h2>
        <button class="btn-close" (click)="cancelEdit()">&times;</button>
      </div>

      <form [formGroup]="editForm" (submit)="updateLecturer()">
        <div class="form-grid">
          <!-- Full Name -->
          <div class="form-group">
            <label for="edit-name">Full Name *</label>
            <input 
              id="edit-name"
              type="text" 
              formControlName="name" 
              class="form-input"
            />
            <div class="error-text" *ngIf="editForm.get('name')?.touched && editForm.get('name')?.invalid">
              Name is required (min 3 characters)
            </div>
          </div>

          <!-- Department -->
          <div class="form-group">
            <label for="edit-department">Department *</label>
            <input 
              id="edit-department"
              type="text" 
              formControlName="department" 
              class="form-input"
            />
            <div class="error-text" *ngIf="editForm.get('department')?.touched && editForm.get('department')?.invalid">
              Department is required
            </div>
          </div>

          <!-- Email -->
          <div class="form-group">
            <label for="edit-email">Email *</label>
            <input 
              id="edit-email"
              type="email" 
              formControlName="email" 
              class="form-input"
            />
            <div class="error-text" *ngIf="editForm.get('email')?.touched && editForm.get('email')?.errors?.['required']">
              Email is required
            </div>
            <div class="error-text" *ngIf="editForm.get('email')?.touched && editForm.get('email')?.errors?.['email']">
              Please enter a valid email
            </div>
          </div>

          <!-- Mobile Number (Optional) -->
          <div class="form-group">
            <label for="edit-mobileNo">Mobile Number</label>
            <input 
              id="edit-mobileNo"
              type="text" 
              formControlName="mobileNo" 
              placeholder="Optional"
              class="form-input"
            />
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="editForm.invalid || isLoading">
            {{ isLoading ? 'Updating...' : 'Update Lecturer' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ==================== ASSIGN SUBJECTS FORM ==================== -->
  
  <div *ngIf="showAssignForm" class="form-modal">
    <div class="form-container">
      <div class="form-header">
        <h2>Assign Subjects: {{ selectedLecturer?.name }}</h2>
        <button class="btn-close" (click)="cancelAssign()">&times;</button>
      </div>

      <div class="assign-content">
        <p class="info-text">
          Select up to 3 subjects for this lecturer (Currently selected: {{ selectedSubjectIds.length }}/3)
        </p>

        <div class="subjects-grid">
          <!-- 
            ANGULAR CONCEPT: *ngFor Directive
            Loops through array and creates elements for each item
          -->
          <div 
            *ngFor="let subject of availableSubjects" 
            class="subject-checkbox"
            [class.selected]="isSubjectSelected(subject.id)"
            (click)="toggleSubjectSelection(subject.id)"
          >
            <input 
              type="checkbox" 
              [checked]="isSubjectSelected(subject.id)"
              [id]="'subject-' + subject.id"
            />
            <label [for]="'subject-' + subject.id">
              <strong>{{ subject.subjectCode }}</strong>
              <span>{{ subject.subjectName }}</span>
            </label>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="cancelAssign()">
            Cancel
          </button>
          <button 
            type="button" 
            class="btn btn-primary" 
            (click)="assignSubjects()"
            [disabled]="selectedSubjectIds.length === 0 || isLoading"
          >
            {{ isLoading ? 'Assigning...' : 'Assign Subjects' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== LECTURERS TABLE ==================== -->
  
  <div class="table-container" *ngIf="!isLoading">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Lecturer ID</th>
          <th>Name</th>
          <th>Username</th>
          <th>Department</th>
          <th>Email</th>
          <th>Subjects (Max 3)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Show message if no lecturers -->
        <tr *ngIf="lecturers.length === 0">
          <td colspan="8" class="no-data">
            No lecturers found. Click "Create New Lecturer" to add one.
          </td>
        </tr>

        <!-- Loop through lecturers -->
        <tr *ngFor="let lecturer of lecturers">
          <td>{{ lecturer.id }}</td>
          <td><span class="badge badge-blue">{{ lecturer.lecturerId }}</span></td>
          <td><strong>{{ lecturer.name }}</strong></td>
          <td>{{ lecturer.username }}</td>
          <td>{{ lecturer.department }}</td>
          <td>{{ lecturer.email }}</td>
          <td>
            <span class="subject-count">{{ getSubjectCount(lecturer) }} subjects</span>
            <div class="subject-list">{{ getSubjectNames(lecturer) }}</div>
          </td>
          <td>
            <div class="action-buttons">
              <button 
                class="btn-action btn-edit" 
                (click)="openEditForm(lecturer)"
                title="Edit lecturer"
              >
                Edit
              </button>
              <button 
                class="btn-action btn-assign" 
                (click)="openAssignForm(lecturer)"
                title="Assign subjects"
              >
                Assign
              </button>
              <button 
                class="btn-action btn-delete" 
                (click)="deleteLecturer(lecturer)"
                title="Delete lecturer"
              >
                Delete
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>